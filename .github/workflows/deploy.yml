name: Deployment Pipeline

on:
  workflow_dispatch:
    inputs:
      confirm_deploy:
        description: 'Confirm deployment?'
        type: boolean
        required: true
        default: false

jobs:
  check-ci-status:
    runs-on: ubuntu-latest
    steps:
      - name: Download success artifact
        uses: actions/download-artifact@v4
        with:
          name: success-artifact
          path: ./artifact

      - name: Check if CI passed
        run: |
          if [ ! -f ./artifact/success.txt]; then
            echo "CI Pipeline did not pass. Aborting deployment."
            exit 1
          else
            echo "CI Pipeline passed. Proceeding with deployment."
          fi

  PROD:
    runs-on: ubuntu-latest
    needs: check-ci-status
    environment:
      name: Prod
      url: https://example-prod-url.com

    if: github.event.inputs.confirm_deploy == 'true'
    steps:
      - name: Deploy
        run: echo "Deploying to Prod"
